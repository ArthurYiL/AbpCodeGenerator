@{
    ViewData["Title"] = "ABPCodeGenerator";
    ViewBag.PageName = "Template";
}

<div class="container">

    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">生成模板<small></small></h1>
    </div>

    <form class="form-group">
        <label for="SqlServerConnectionString">数据库连接字符串</label>
        <input type="text" class="form-control" id="SqlServerConnectionString" aria-describedby="SqlServerConnectionString" placeholder="请输入数据库连接字符串">
    </form>

    <button type="submit" class="btn btn-primary float-right ml-2" id="Save">保存</button>
    <button type="submit" class="btn btn-primary float-right" id="Validate">验证</button>

</div>

@section Scripts
{
    <script>
        var page = null;

        page = {
            $Save: $("#Save"),
            $Validate: $("#Validate"),
            $SqlServerConnectionString: $("#SqlServerConnectionString"),

            Save: function () {
                var connectionString = page.$SqlServerConnectionString.val();

                if (connectionString === null || connectionString === "") {

                    site.app.notify.error("数据库连接字符串不能为空");

                    return;
                }

                //保存字符串到本地浏览器
                localStorage.setItem(site.app.setting.key_SqlServerConnectionStrig, connectionString);

                site.app.notify.success("保存成功");
            },

            ValidateSqlServerConnectionString: function () {

                var connectionString = page.$SqlServerConnectionString.val();

                //if (connectionString === null || connectionString === "") {
                //    site.app.notify.error("数据库连接字符串不能为空");

                //    return false;
                //}

                $.post(globalSetting.baseUrl + "Home/ValidateSqlServerConnection", { SqlServerConnectionString: connectionString }, function (result) {
                    if (result.errorCode === site.app.setting.noneErrorCode) {
                        site.app.notify.success("验证成功");

                        return true;
                    } else {
                        site.app.notify.error(result.errorMessage);

                        return false;
                    }
                })
            },

            Init: function () {
                page.$Save.click(function () {
                    page.Save();
                });

                page.$Validate.click(function () {
                    page.ValidateSqlServerConnectionString();
                });

                //获取之前保存到本地浏览器的数据库连接字符串
                var connectionString = localStorage.getItem(site.app.setting.key_SqlServerConnectionStrig);

                if (connectionString !== null || connectionString !== "") {
                    page.$SqlServerConnectionString.val(connectionString);
                }
            }
        };

        page.Init();

    </script>
}
